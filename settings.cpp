#include <cmath>
#include <iostream>
#include <stdio.h>
#include <vector>
#include <sys/time.h>
#include <chrono>
#include <bits/stdc++.h>

#include <NTL/RR.h>
#include <NTL/xdouble.h>
#include <NTL/ZZ.h>
#include <NTL/ZZX.h>
#include "NTL/RR.h"
#include "NTL/vec_RR.h"
#include "NTL/mat_RR.h"
#include <NTL/BasicThreadPool.h>

#include <NTL/mat_ZZ.h>
#include <NTL/mat_poly_ZZ.h>
#include <NTL/ZZXFactoring.h>

#include "HEAAN/src/HEAAN.h"

#include <unistd.h>
#include <sys/resource.h>
#include <bits/stdc++.h>
#include <sys/sysinfo.h>
#include <omp.h>

using namespace NTL;
using namespace std;


#ifndef __SETTING__
#define __SETTING__


typedef complex<double> cdouble;

// Network structure parameters
// Fast bicubic interpolation weight parameters

vector<double>BicKerweight{0.00390625,0,-0.03515625,-0.0625,-0.03515625,0,0.00390625,0,
                           0,0,0,0,0,0,0,0,
                           -0.03515625,0,0.31640625,0.5625,0.31640625,0,-0.03515625,0,
                           -0.0625,0,0.5625,1,0.5625,0,-0.0625,0,
                           -0.03515625,0,0.31640625,0.5625,0.31640625,0,-0.03515625,0, 
                           0,0,0,0,0,0,0,0,
                           0.00390625,0,-0.03515625,-0.0625,-0.03515625,0,0.00390625,0,
                           0,0,0,0,0,0,0,0};

// vector<double>BicKerweight{0.00137175, 0.00274348, 0, -0.01234568, -0.02880658, -0.03703704, -0.02880658, -0.01234568, 0, 0.00274348, 0.00137174, 0,
// 0.00274348, 0.00548697, 0 -0.02469136, -0.05761317, -0.07407407, -0.05761317, -0.02469136, 0, 0.00548697, 0.00274348, 0,
// 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
// -0.01234568, -0.02469136, 0, 0.11111111, 0.25925926, 0.33333333, 0.25925926, 0.11111111, 0, -0.02469136, -0.01234568, 0,
// -0.02880658, -0.05761317, 0, 0.25925926, 0.60493827, 0.77777778, 0.60493827, 0.25925926, 0, -0.05761317, -0.02880658, 0,
// -0.03703704, -0.07407407, 0, 0.33333333, 0.77777778, 1, 0.77777778, 0.33333333, 0, -0.07407407, -0.03703704, 0,
// -0.02880658, -0.05761317, 0, 0.25925926, 0.60493827, 0.77777778, 0.60493827, 0.25925926, 0, -0.05761317, -0.02880658, 0,
// -0.01234568, -0.02469136, 0, 0.11111111, 0.25925926, 0.33333333, 0.25925926, 0.11111111, 0, -0.02469136, -0.01234568, 0,
// 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
// 0.00274348, 0.00548697, 0, -0.02469136, -0.05761317, -0.07407407, -0.05761317, -0.02469136, 0, 0.00548697, 0.00274348, 0,
// 0.00137175, 0.00274348, 0, -0.01234568, -0.02880658, -0.03703704, -0.02880658, -0.01234568, 0, 0.00274348,  0.00137174, 0,
// 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
// };

// vector<double>BicKerweight{0.00054932, 0.00146484, 0.00164795, 0, -0.00531006, -0.01318359, -0.02032471, -0.02343750, -0.02032471, -0.01318359, -0.00531006, 0, 0.00164795, 0.00146484, 0.00054932, 0,
// 0.00146484, 0.00390625, 0.00439453, 0, -0.01416016, -0.03515625, -0.05419922, -0.0625, -0.05419922, -0.03515625, -0.01416016, 0, 0.00439453, 0.00390625, 0.00146484, 0,
// 0.00164795, 0.00439453, 0.00494385, 0, -0.01593018, -0.03955078, -0.06097412, -0.0703125, -0.06097412, -0.03955078, -0.01593018, 0, 0.00494385,- 0.00439453, 0.00164795, 0,
// 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
// -0.00531006, -0.01416016, -0.01593018, 0, 0.05133057, 0.12744141, 0.19647217, 0.2265625, 0.19647217, 0.12744141, 0.05133057,0, -0.01593018, -0.01416016, -0.00531006, 0,
// -0.01318359, -0.03515625, -0.03955078, 0,  0.12744141, 0.31640625, 0.48779297, 0.5625, 0.48779297, 0.31640625, 0.12744141, 0, -0.03955078, -0.03515625, -0.01318359, 0,
// -0.02032471, -0.05419922, -0.06097412, 0, 0.19647217, 0.48779297, 0.75201416, 0.8671875, 0.75201416, 0.48779297, 0.19647217, 0, -0.06097412, -0.05419922, -0.02032471, 0,
// -0.02343750, -0.0625, -0.0703125, 0, 0.2265625, 0.5625, 0.8671875, 1.0, 0.8671875, 0.5625, 0.2265625, 0, -0.0703125, -0.0625, -0.02343750, 0,
// -0.02032471, -0.05419922, -0.06097412, 0, 0.19647217, 0.48779297, 0.75201416, 0.8671875, 0.75201416, 0.48779297, 0.19647217,0, -0.06097412, -0.05419922, -0.02032471, 0,
// -0.01318359, -0.03515625, -0.03955078, 0,  0.12744141, 0.31640625, 0.48779297, 0.5625, 0.48779297, 0.31640625, 0.12744141, 0, -0.03955078, -0.03515625, -0.01318359, 0,
// -0.00531006, -0.01416016, -0.01593018, 0, 0.05133057, 0.12744141, 0.19647217, 0.2265625, 0.19647217, 0.12744141, 0.05133057,0, -0.01593018, -0.01416016, -0.00531006, 0,
// 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
// 0.00164795, 0.00439453, 0.00494385, 0, -0.01593018, -0.03955078, -0.06097412, -0.0703125, -0.06097412, -0.03955078, -0.01593018, 0, 0.00494385,- 0.00439453, 0.00164795, 0,
// 0.00146484, 0.00390625, 0.00439453, 0, -0.01416016, -0.03515625, -0.05419922, -0.0625, -0.05419922, -0.03515625, -0.01416016, 0, 0.00439453, 0.00390625, 0.00146484, 0,
// 0.00054932, 0.00146484, 0.00164795, 0, -0.00531006, -0.01318359, -0.02032471, -0.02343750, -0.02032471, -0.01318359, -0.00531006, 0, 0.00164795, 0.00146484, 0.00054932, 0,
// 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
// };

int inChanels[]= {3,64,64,64,64,64,64,64,64};
// int outChanels[]={64,64,64,64,64,64,64,64,3};
int outChanels[]={64,64,64,64,64,64,64,64,12};
int rowKernelsSize[] ={3,3,3,3,3,3,3,3,3};
int colKernelsSize[] ={3,3,3,3,3,3,3,3,3};

// int inChanels[]= {3,64,64,64,64,64,64,64,64,64};
// int outChanels[]={64,64,64,64,64,64,64,64,64,12};
// int rowKernelsSize[] ={3,3,3,3,1,1,1,1,3,3};
// int colKernelsSize[] ={3,3,3,3,1,1,1,1,3,3};
double dp_rate = 0.7;
//pooling setting
int stride = 1;
int kernelSize = 3;
int padding = 1;
int globalSizeRow=-1;
int globalSizeCol=-1;

int fa = 2;
int BickernelCol = 4*fa;
int cipherNum=0;
int inputchannel = 3;

////////// Testing ///////////////////
// int inChanels[]= {1,64,128,64};
// int outChanels[]={1,64,64,1};


// Encryption scheme parameters
long logq = 1200; ///< Ciphertext Modulus
long logp = 30; ///< Real message will be quantized by multiplying 2^40
long logn = 9; ///< log2(The number of slots)
long logpc = 30;
long slots = 1 << logn;  /// << is equivalent to binary left shift, equivalent to 2^n

vector<double>activationParams{6.83593757e-06, 2.34375001e-01,4.99988281e-01,1.87499999e-01};




vector<string>  weigtsFiles {"weight/0.weight","weight/1.weight",
                            "weight/2.weight","weight/3.weight",
                            "weight/4.weight","weight/5.weight",
                            "weight/6.weight","weight/7.weight",
                            "weight/8.weight"};


vector<vector<cdouble> > globalWeightMasks;
vector<vector<cdouble> > BicWegihtMasks;
vector<vector<vector<cdouble> > > multiglobalWeightMasks;
vector<vector<vector<cdouble> > > multiBicWegihtMasks;

TimeUtils timeutils;


#endif